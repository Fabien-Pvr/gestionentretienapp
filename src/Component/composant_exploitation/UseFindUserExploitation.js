import { useState, useEffect } from "react";
import { onValue, ref } from "firebase/database";
import { db } from "../../Services/Firebase";

const useFindUserExploitation = (userId) => {
  const [userExploitationId, setUserExploitationId] = useState(null);

  useEffect(() => {

    const exploitationRef = ref(db, `Exploitation`);

    const unsubscribe = onValue(exploitationRef, (snapshot) => {
      const exploitations = snapshot.val();

      for (const [expId, value] of Object.entries(exploitations)) {

        if (value.IdUsers && value.IdUsers[userId]) {

          setUserExploitationId(expId);
          break;
        }
      }
    });

    return () => unsubscribe();
  }, [userId]);

  return userExploitationId;
};

export default useFindUserExploitation;
