import { useState, useEffect } from "react";
import { onValue, ref } from "firebase/database";
import { db } from "../Firebase";

const useFindUserExploitation = (userId) => {
  const [userExploitationId, setUserExploitationId] = useState(null);

  useEffect(() => {
    // Rechercher dans toutes les exploitations
    const exploitationRef = ref(db, `Exploitation`);

    const unsubscribe = onValue(exploitationRef, (snapshot) => {
      const exploitations = snapshot.val();
      // Parcourir toutes les exploitations
      for (const [expId, value] of Object.entries(exploitations)) {
        // Vérifier si l'utilisateur est présent dans l'exploitation
        if (value.IdUsers && value.IdUsers[userId]) {
          // Définir l'ID de l'exploitation si l'utilisateur est trouvé
          setUserExploitationId(expId);
          break;
        }
      }
    });

    return () => unsubscribe();
  }, [userId]);

  return userExploitationId;
};

export default useFindUserExploitation;
